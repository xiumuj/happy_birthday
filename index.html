<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš ï¸ ç³»ç»Ÿè­¦æŠ¥ï¼šæ£€æµ‹åˆ°30å²ç”Ÿç‰©ä½“ âš ï¸</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        :root {
            --neon-pink: #ff2a6d;
            --neon-blue: #05d9e8;
            --neon-purple: #d300c5;
            --dark-bg: #0d0221;
            --glow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-pink);
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--dark-bg);
            color: #fff;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(5, 217, 232, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(5, 217, 232, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }
        
        .cyber-border {
            border: 2px solid var(--neon-pink);
            box-shadow: var(--glow);
            position: relative;
        }
        
        .cyber-border::before {
            content: "";
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 1px solid var(--neon-blue);
            z-index: -1;
        }
        
        header {
            text-align: center;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, var(--neon-pink), var(--neon-purple), var(--neon-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px rgba(255, 42, 109, 0.5);
            margin-bottom: 1rem;
            animation: flicker 1.5s infinite alternate;
        }
        
        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                text-shadow: 
                    0 0 5px var(--neon-pink),
                    0 0 10px var(--neon-purple),
                    0 0 20px var(--neon-blue);
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }
        
        .age-counter {
            font-size: 5rem;
            font-weight: bold;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
            margin: 1rem 0;
        }
        
        #memory-map {
            height: 700px;
            width: 90%;
            margin: 2rem auto;
            position: relative;
        }
        
        .map-overlay {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(13, 2, 33, 0.8);
            padding: 1rem;
            border: 1px solid var(--neon-blue);
            box-shadow: var(--glow);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            overflow: auto;
        }
        
        .modal-content {
            background-color: var(--dark-bg);
            margin: 5% auto;
            padding: 20px;
            border: 2px solid var(--neon-pink);
            width: 80%;
            max-width: 800px;
            position: relative;
            box-shadow: var(--glow);
        }
        
        .close {
            color: var(--neon-blue);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px var(--neon-blue);
        }
        
        .close:hover {
            color: var(--neon-pink);
            box-shadow: 0 0 15px var(--neon-pink);
        }
        
        .photo-slide {
            display: none;
            text-align: center;
            position: relative;
        }
        
        .photo-slide img {
            max-width: 100%;
            border: 1px solid var(--neon-blue);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(5, 217, 232, 0.5);
        }
        
        .photo-slide img:hover {
            box-shadow: 0 0 15px var(--neon-pink);
        }
        
        .photo-caption {
            margin-top: 1rem;
            color: var(--neon-blue);
            font-size: 1.2rem;
        }
        
        .console {
            width: 90%;
            margin: 2rem auto;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--neon-blue);
            height: 200px;
            overflow-y: auto; /* æ”¹ä¸º auto */
            font-family: monospace;
            -webkit-overflow-scrolling: touch; /* å¢å¼ºç§»åŠ¨ç«¯æ»šåŠ¨æµç•…åº¦ */
        }
        
        .console-line {
            margin: 0.5rem 0;
            color: var(--neon-blue);
        }
        
        .console-input {
            display: flex;
            margin-top: 0.5rem;
        }
        
        .prompt {
            color: var(--neon-pink);
            margin-right: 0.5rem;
        }
        
        .cyber-button {
            background: transparent;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 0.5rem 1rem;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            margin: 0.5rem;
            transition: all 0.3s;
        }
        
        .cyber-button:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
            box-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
        }
        
        .cyber-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(5, 217, 232, 0.4), transparent);
            transition: all 0.5s;
        }
        
        .cyber-button:hover::before {
            left: 100%;
        }
        
        /* è‹±é›„æ¨¡å—åŠ¨ç”» */
        @keyframes borderPulse {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }
        
        @keyframes expandLine {
            0% { transform: scaleX(0); opacity: 0; }
            50% { transform: scaleX(1); opacity: 0.7; }
            100% { transform: scaleX(0); opacity: 0; }
        }
        
        .cyber-card {
            transition: all 0.5s ease;
        }
        
        .cyber-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px var(--neon-blue), 0 0 40px var(--neon-pink);
        }
        
        /* å“åº”å¼æ ·å¼ */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            #memory-map {
                height: 450px; /* å¢åŠ å¹³æ¿ç«¯çš„åœ°å›¾é«˜åº¦ */
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .cyber-card {
                padding: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.4rem; /* ç¨å¾®ç¼©å°ä¸€ç‚¹ */
                padding: 0 10px;
            }
            
            .age-counter {
                font-size: 2.8rem;
                margin: 0.5rem 0;
            }
            
            #memory-map {
                height: 350px; /* å¢åŠ åœ°å›¾é«˜åº¦ï¼Œæ–¹ä¾¿æ“ä½œ */
                width: 95%;
            }
            
            .cyber-button {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
                margin: 0.3rem;
                min-width: 100px; /* å¢åŠ æœ€å°å®½åº¦æ–¹ä¾¿ç‚¹å‡» */
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 15px;
            }

            .close {
                width: 44px; /* å¢åŠ å…³é—­æŒ‰é’®ç‚¹å‡»åŒºåŸŸ */
                height: 44px;
                right: 10px;
                top: 5px;
            }
            
            .photo-thumbnail {
                width: 70px;
                height: 70px;
            }

            .thumbnail-container {
                grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); /* ç§»åŠ¨ç«¯æ¯è¡Œæ˜¾ç¤ºæ›´å¤šç¼©ç•¥å›¾ */
                gap: 5px;
                max-height: 200px;
            }
            
            .console {
                height: 140px;
                font-size: 0.75rem;
                width: 95%;
            }

            .letter-content {
                width: 95%;
                padding: 20px;
                font-size: 1rem;
                line-height: 1.6;
                margin: 2% auto;
            }
            
            .hero-content {
                padding: 10px !important;
                width: 100% !important;
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
            }
            
            .hero-content .cyber-card {
                padding: 1.2rem !important;
                width: calc(100% - 20px) !important;
                max-width: none !important;
                margin: 0 auto !important;
            }

            .decorative-elements {
                display: none; /* ç§»åŠ¨ç«¯éšè—æµ®åŠ¨è£…é¥°ï¼Œå‡å°‘å¹²æ‰° */
            }
            
            .hero-content h2 {
                font-size: 1.3rem !important;
                margin-bottom: 0.8rem !important;
            }
            
            .hero-content p {
                font-size: 0.95rem !important;
                margin-bottom: 1.2rem !important;
            }

            .hero-bg {
                filter: brightness(0.5) blur(2px) !important;
            }

            .hero-content .cyber-button {
                padding: 0.7rem 1.8rem !important;
                font-size: 1.1rem !important;
                width: 80% !important; /* æˆæƒæŒ‰é’®åœ¨ç§»åŠ¨ç«¯æ›´é†’ç›® */
            }

            #cake {
                font-size: 3rem !important;
                margin-bottom: 1rem !important;
            }
        }

        /* ç…§ç‰‡ç¼©ç•¥å›¾æ ·å¼ */
        .photo-thumbnail {
            width: 120px;
            height: 120px;
            object-fit: cover;
            margin: 8px;
            border: 2px solid var(--neon-purple);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            box-shadow: 0 0 5px rgba(5, 217, 232, 0.3);
        }

        .photo-thumbnail:hover {
            transform: scale(1.1);
            border-color: var(--neon-pink);
            box-shadow: 0 0 10px var(--neon-pink);
        }

        .thumbnail-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--neon-blue) var(--dark-bg);
            -webkit-overflow-scrolling: touch; /* å¢å¼ºç§»åŠ¨ç«¯æ»šåŠ¨æµç•…åº¦ */
        }
        
        .thumbnail-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .thumbnail-container::-webkit-scrollbar-track {
            background: var(--dark-bg);
            border-radius: 10px;
        }
        
        .thumbnail-container::-webkit-scrollbar-thumb {
            background-color: var(--neon-blue);
            border-radius: 10px;
            border: 2px solid var(--dark-bg);
        }
        
        /* ç…§ç‰‡å¢™åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .photo-thumbnail {
            animation: fadeIn 0.3s ease forwards;
            animation-delay: calc(0.05s * var(--photo-index, 0));
            opacity: 0;
        }

        /* ä¿¡å°å’Œä¿¡çº¸æ ·å¼ */
        .envelope-modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            overflow: auto;
        }

        .envelope {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 50px auto;
            background: linear-gradient(45deg, var(--neon-pink), var(--neon-purple));
            border-radius: 5px;
            box-shadow: var(--glow);
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .envelope:hover {
            transform: scale(1.05);
        }

        .envelope::before {
            content: "â¤";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .letter-modal {
            display: none;
            position: fixed;
            z-index: 3100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            overflow: auto;
        }

        .letter-content {
            background: var(--dark-bg);
            margin: 5% auto;
            padding: 30px;
            width: 80%;
            max-width: 800px;
            border: 2px solid var(--neon-blue);
            box-shadow: var(--glow);
            position: relative;
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--neon-blue);
            white-space: pre-line;
            word-wrap: break-word; /* ç¡®ä¿é•¿æ–‡æœ¬ä¸æº¢å‡º */
        }

        .letter-close {
            position: absolute;
            right: 15px;
            top: 15px;
            color: var(--neon-pink);
            font-size: 28px;
            cursor: pointer;
            width: 44px; /* å¢åŠ ç‚¹å‡»åŒºåŸŸ */
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .letter-close:hover {
            background: var(--neon-pink);
            color: var(--dark-bg);
            box-shadow: 0 0 10px var(--neon-pink);
        }
    </style>
</head>
<body>
    <!-- å¼€å±åŠ¨ç”» - è‹±é›„æ¨¡å— -->
    <div id="splash-screen" class="animate__animated animate__fadeIn" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 3000; overflow: hidden;">
        <!-- èƒŒæ™¯å›¾ç‰‡ - å¯ä»¥æ–¹ä¾¿æ›¿æ¢ -->
        <div class="hero-bg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url('https://pic.tangsong.qzz.io/birthday/moermansike_4.jpg'); background-size: cover; background-position: center; filter: brightness(0.3) blur(5px); z-index: -1;"></div>
        
        <!-- ç½‘æ ¼å åŠ å±‚ -->
        <div class="grid-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(5, 217, 232, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(5, 217, 232, 0.1) 1px, transparent 1px); background-size: 20px 20px; opacity: 0.7; z-index: 0;"></div>
        
        <!-- å†…å®¹å®¹å™¨ -->
        <div class="hero-content" style="position: relative; z-index: 1; height: 100%; width: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2rem;">
            <div class="cyber-card" style="background: rgba(13, 2, 33, 0.7); border: 2px solid var(--neon-pink); box-shadow: var(--glow); padding: 3rem; max-width: 600px; width: 90%; text-align: center; position: relative; overflow: hidden;">
                <!-- é—ªçƒè¾¹æ¡†æ•ˆæœ -->
                <div class="card-border-effect" style="position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; border: 2px solid var(--neon-blue); opacity: 0; animation: borderPulse 3s infinite alternate;"></div>
                
                <div id="cake" style="font-size: 5rem; margin-bottom: 2rem; position: relative; display: inline-block;">
                    ğŸ‚
                    <div class="glow-effect" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255, 42, 109, 0.4) 0%, transparent 70%); filter: blur(10px); z-index: -1;"></div>
                </div>
                
                <h2 class="animate__animated animate__fadeInUp" style="color: var(--neon-pink); text-align: center; padding: 0 1rem; font-size: 2.2rem; margin-bottom: 1.5rem; text-shadow: 0 0 10px var(--neon-pink);">âš ï¸ ç³»ç»Ÿè­¦æŠ¥ âš ï¸</h2>
                <p class="animate__animated animate__fadeInUp animate__delay-1s" style="color: var(--neon-blue); font-size: 1.5rem; margin-bottom: 2rem; text-shadow: 0 0 5px var(--neon-blue);">æ£€æµ‹åˆ°å¯çˆ±ç”Ÿç‰©å³å°†30å²ï¼</p>
                
                <button id="enter-site" class="cyber-button animate__animated animate__pulse animate__infinite" style="margin-top: 1rem; font-size: 1.2rem; padding: 0.8rem 2rem; background: linear-gradient(45deg, rgba(5, 217, 232, 0.2), rgba(211, 0, 197, 0.2)); border-width: 2px;">æˆæƒè®¿é—®</button>
            </div>
            
            <!-- è£…é¥°å…ƒç´  -->
            <div class="decorative-elements">
                <div class="cyber-circle" style="position: absolute; top: 15%; left: 15%; width: 50px; height: 50px; border: 1px solid var(--neon-blue); border-radius: 50%; opacity: 0.5; animation: float 8s infinite ease-in-out;"></div>
                <div class="cyber-circle" style="position: absolute; bottom: 20%; right: 10%; width: 80px; height: 80px; border: 1px solid var(--neon-pink); border-radius: 50%; opacity: 0.5; animation: float 10s infinite ease-in-out reverse;"></div>
                <div class="cyber-line" style="position: absolute; top: 40%; left: 0; width: 100px; height: 1px; background: linear-gradient(90deg, transparent, var(--neon-purple), transparent); opacity: 0.7; animation: expandLine 7s infinite;"></div>
                <div class="cyber-line" style="position: absolute; bottom: 30%; right: 0; width: 150px; height: 1px; background: linear-gradient(90deg, transparent, var(--neon-blue), transparent); opacity: 0.7; animation: expandLine 5s infinite reverse;"></div>
            </div>
        </div>
    </div>

    <!-- ä¸»é¡µé¢å†…å®¹ -->
    <div id="main-content" style="display: none;">
        <header class="cyber-border">
            <h1 class="animate__animated animate__fadeInDown">SYSTEM_CELEBRATION.EXE</h1>
            <div class="age-counter" id="age-counter">29.9999</div>
            <p style="color: var(--neon-blue);">>>> æ­£åœ¨åˆå§‹åŒ–30å²åè®® <<<</p>
            <div style="display: flex; justify-content: center; margin-top: 1rem;">
                <button class="cyber-button" onclick="showModal('photos'); playClickSound()" onmouseover="playClickSound()">æŸ¥çœ‹è®°å¿†</button>
                <button class="cyber-button" onclick="activateGlitch(); playClickSound()" onmouseover="playClickSound()">å¼€å§‹è®°å¿†åŠ è½½</button>
            </div>
        </header>

        <!-- è¶³è¿¹åœ°å›¾ -->
        <section style="margin: 3rem 0;">
            <h2 style="text-align: center; color: var(--neon-purple); margin-bottom: 1rem;">>>> è®°å¿†åæ ‡è¿½è¸ªç³»ç»Ÿ <<<</h2>
            <div id="memory-map" class="cyber-border"></div>
            <div class="map-overlay">
                <p style="margin: 0; color: var(--neon-blue);">å·²è®°å½•åæ ‡ç‚¹: <span id="location-count">0</span></p>
                <p style="margin: 0; color: var(--neon-pink);">æ€»é‡Œç¨‹: <span id="total-distance">0</span> km</p>
            </div>
        </section>

        <!-- ç…§ç‰‡æ¨¡æ€æ¡† -->
        <div id="photo-modal" class="modal">
            <div class="modal-content cyber-border">
                <span class="close" onclick="closeModal('photos')" style="position: absolute; right: 15px; top: 10px; font-size: 30px; z-index: 1000;">&times;</span>
                <div class="photo-slide">
                    <img src="" alt="è®°å¿†ç…§ç‰‡" style="max-height: 60vh;">
                    <div class="photo-caption"></div>
                </div>
                <h3 style="color: var(--neon-blue); text-align: center; margin: 15px 0 5px 0;">è®°å¿†ç…§ç‰‡å¢™</h3>
                <div class="thumbnail-container" id="thumbnail-container"></div>
                <div style="text-align: center; margin-top: 1rem;">
                    <button class="cyber-button" onclick="plusSlides(-1)">ä¸Šä¸€å¼ </button>
                    <button class="cyber-button" onclick="plusSlides(1)">ä¸‹ä¸€å¼ </button>
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶å° -->
        <section class="cyber-border" style="width: 90%; margin: 2rem auto; padding: 1rem;">
            <h2 style="text-align: center; color: var(--neon-blue);">>>> ç³»ç»Ÿæ§åˆ¶å° <<<</h2>
            <div class="console" id="console-output">
                <div class="console-line">> ç³»ç»Ÿå¯åŠ¨ä¸­...</div>
                <div class="console-line">> åŠ è½½30å²åº†ç¥åè®®...</div>
                <div class="console-line">> æ­£åœ¨æ‰«æè®°å¿†æ•°æ®åº“...</div>
                <div class="console-line">> è­¦å‘Š: æ£€æµ‹åˆ°è¿‡å¤šç¬‘å®¹æ•°æ®!</div>
                <div class="console-line">> åˆå§‹åŒ–åœ°å›¾ç³»ç»Ÿ...</div>
            </div>
            <div class="console-input">
                <span class="prompt">></span>
                <input type="text" style="flex-grow: 1; background: transparent; border: none; border-bottom: 1px solid var(--neon-blue); color: white; font-family: monospace; outline: none;" id="console-input" placeholder="è¾“å…¥ HELP è·å–å‘½ä»¤åˆ—è¡¨">
            </div>
        </section>

        <!-- ä¿¡å°æ¨¡æ€æ¡† -->
        <div id="envelope-modal" class="envelope-modal">
            <div class="envelope" onclick="showLetter()"></div>
        </div>

        <!-- ä¿¡çº¸æ¨¡æ€æ¡† -->
        <div id="letter-modal" class="letter-modal">
            <div class="letter-content">
                <span class="letter-close" onclick="closeLetter()">&times;</span>
                <div id="letter-text"></div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <footer style="text-align: center; padding: 2rem; color: var(--neon-blue);">
            <p>SYSTEM STATUS: CELEBRATION_MODE_ACTIVATED</p>
            <p>Â© 2025 çˆ±ä½ çš„è’œé¦™ç”·å­© | å®‰å…¨ç­‰çº§: ç»å¯†</p>
        </footer>
    </div>

    <script src="https://webapi.amap.com/maps/js/loader.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script>
        // æ˜¾ç¤ºä¿¡å°å’Œä¿¡çº¸çš„å‡½æ•°
        function showLetter() {
            // åœæ­¢å½“å‰èƒŒæ™¯éŸ³ä¹
            if (window.currentAudio) {
                window.currentAudio.pause();
                window.currentAudio.currentTime = 0;
            }
            // ç¡®ä¿åœæ­¢birthday.mp3
            if (window.birthdayAudio) {
                window.birthdayAudio.pause();
                window.birthdayAudio.currentTime = 0;
            }
            // æ’­æ”¾æ–°çš„èƒŒæ™¯éŸ³ä¹
            window.currentAudio = new Audio('music/loveyou.mp3');
            window.currentAudio.play();
            
            document.getElementById('envelope-modal').style.display = 'none';
            document.getElementById('letter-modal').style.display = 'block';
            document.getElementById('letter-text').innerText = [
                "äº²çˆ±çš„æ·»å‡€ï¼š",
                "ä»Šå¤©æ˜¯ä½ 30å²ç”Ÿæ—¥,ä¹Ÿæ˜¯å’Œä½ ç›¸è¯†çš„ç¬¬å…«å¹´ï¼Œç»“å©šçš„ç¬¬ä¸‰å¹´ï¼Œæ—¶é—´åƒæˆ‘ä»¬è‡ªé©¾æ¸¸æ—¶ç›˜å±±å…¬è·¯çš„è½¬è§’ï¼Œæ˜æ˜è®°å¾—æ¯ä¸ªè½¬å¼¯æ—¶çš„å¿ƒè·³ï¼Œå›å¤´æœ›å»å´å·²æ˜¯ä¸€è·¯ç¹èŠ±ã€‚",
                "è¿˜è®°å¾—æ·é‡Œåˆ«å°”å¡é£˜é›ªçš„å¤œæ™šï¼Œä½ å¸¦ç€åšåšçš„æ‰‹å¥—é€—å¼„è·Ÿè¿‡æ¥çš„é›ªæ©‡çŠ¬ï¼Œä»¥é˜²æš´é›ªå°è·¯æˆ‘ä»¬ä¸‹å®šå†³å¿ƒè¿å¤œæ‰¾è½¦é€ƒç¦»ï¼›æ‘©å°”æ›¼æ–¯å…‹å‡›å†½çš„å¯’é£ä¸‹ï¼Œæˆ‘ä»¬ç«™åœ¨é˜¿å»–æ²™å…¬å›­çš„æœ€é«˜ç‚¹ï¼Œçœºæœ›è¿œå¤„çš„ç å¤´å’Œæ‘åº„ã€‚è¿™äº›æ—…ç¨‹åƒå›´å·¾ä¸€èˆ¬ï¼Œé’ˆè„šç»†å¯†å´æ¸©æš–è¸å®ã€‚åæ¥æˆ‘ä»¬å»è¿‡çš„åœ°æ–¹ï¼Œåœ°å›¾ä¸Šéƒ½å˜æˆäº†ä¸“å±çš„åæ ‡â€”â€”æ›¼è°·çš„å¤§çš‡å®«ï¼Œæ™®å‰å²›çš„æµªèŠ±ï¼Œé•¿é‡çš„æˆ·éšç¥ç¤¾ï¼Œå‡½é¦†å±±çš„å¤§é›ªï¼ŒåŒ—æµ·é“çš„æ¸©æ³‰é›¾æ°”ã€‚",
                "å·¥ä½œåçš„æ„Ÿæƒ…å°‘äº†äº›è½°è½°çƒˆçƒˆï¼Œå€’åƒä¸€ç¢—æ¡‚èŠ±é†ªç³Ÿï¼Œç”œå‘³æ²‰æ·€åœ¨ç”Ÿæ´»è¤¶çš±é‡Œã€‚ä¸‹ç­å’Œä½ ä¸€å—å›å®¶ï¼Œåœ¨å®¢å…é‡Œçœ‹ä½ åšé¥­ï¼Œé€—ä¸€ä¼šçŒ«çŒ«ï¼Œæ—¶ä¸æ—¶å»å¨æˆ¿æ‰“æ‰“ä¸‹æ‰‹ï¼Œä¸€å—è¾¹çœ‹ç»¼è‰ºèŠ‚ç›®è¾¹åƒé¥­ã€‚\næˆ‘å¶å°”ä¼šæƒ³,å¦‚æœæˆ‘ç°åœ¨è¿˜æ˜¯ä¸€ä¸ªäººï¼Œä¼šè¿‡ç€æ€æ ·çš„ç”Ÿæ´»å‘¢ï¼Œè‚¯å®šæ˜¯å•è°ƒæ— è¶£çš„ï¼Œå¦‚åŒä½ ä¸åœ¨çš„å‘¨æœ«ã€‚",
                "30å²æ˜¯æ–°çš„èµ·ç‚¹,ä½†å¯¹æˆ‘è€Œè¨€ï¼Œä½ ä¾ç„¶æ˜¯é‚£ä¸ªåœ¨é¦–æ¬¡è‡ªé©¾åœ¨å—æ¾³å¤§æ¡¥ä¸Šæ¬¢å‘¼é›€è·ƒçš„å§‘å¨˜ã€‚è°¢è°¢ä½ è®©æˆ‘ä»'å®…ç”·'å˜æˆ'æ—…äºº'ï¼Œä»'æœ¨å¤´'å˜æˆä¼šç¬¨æ‹™è¡¨è¾¾çˆ±çš„ä¸ˆå¤«ã€‚å¾€åä½™ç”Ÿï¼Œæƒ³å’Œä½ ç»§ç»­æ”¶é›†æ›´å¤šå¹³å‡¡çš„ç¬é—´ï¼šå¯èƒ½æ˜¯æ‰“åŒäººæ¸¸æˆæ—¶çš„äº’ç›¸å˜²è®½ï¼Œå¯èƒ½æ˜¯åœ¨ä½ ç”»ç”»æ—¶é€’è¿‡å»çš„ä¸€æ¯çƒ­æ°´ï¼Œå¯èƒ½æ˜¯æˆ‘åœ¨å·¥ä½œæ—¶ä½ çªç„¶å†²è¿‡æ¥çš„ä¸€ä¸ªæ‹¥æŠ±ã€‚",
                "æˆ‘ä¾ç„¶æ²¡è®°ä½ä½ åœ¨ç»“å©šå…¸ç¤¼ä¸Šçš„é‚£å¥ä»€ä¹ˆæ ‘ä»€ä¹ˆé£æ˜¯æ€ä¹ˆè¯´çš„ï¼Œåªå¥½ç”¨ç®€å•çš„è¯è¯­é€ä¸Šæˆ‘çš„ç¥ç¦ã€‚",
                "ç”Ÿæ—¥å¿«ä¹ï¼Œæˆ‘çš„å§‘å¨˜ã€‚",
                "æ°¸è¿œï¼Œçˆ±ä½ å¦‚åˆï¼"
            ].join('\n\n');
        }

        function closeLetter() {
            document.getElementById('letter-modal').style.display = 'none';
        }

        // å¢å¼ºçš„å¼€å±åŠ¨ç”»
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ åˆå§‹åŠ¨ç”»æ•ˆæœ
            setTimeout(function() {
                const heroContent = document.querySelector('.hero-content');
                if (heroContent) {
                    heroContent.style.opacity = '1';
                }
            }, 500);
        });
        
        document.getElementById('enter-site').addEventListener('click', function() {
            // æŒ‰é’®ç‚¹å‡»æ•ˆæœ
            this.classList.remove('animate__pulse', 'animate__infinite');
            this.classList.add('animate__rubberBand');
            
            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
            playClickSound();
            
function playClickSound() {
    var clickSound = new Audio('sounds/click.mp3');
    clickSound.play();
}

// æ’­æ”¾èƒŒæ™¯éŸ³ä¹
            window.birthdayAudio = new Audio('music/birthday.mp3');
            var isPlaying = true;
            
            // æ·»åŠ å–‡å­å›¾æ ‡ç‚¹å‡»äº‹ä»¶
            const speakerIcon = document.getElementById('speaker-icon');
            speakerIcon.addEventListener('click', function() {
                if (isPlaying) {
                    window.birthdayAudio.pause();
                    speakerIcon.textContent = 'ğŸ”ˆ';
                } else {
                    window.birthdayAudio.play();
                    speakerIcon.textContent = 'ğŸ”Š';
                }
                isPlaying = !isPlaying;
            });
            window.birthdayAudio.play();
            
            // è›‹ç³•çˆ†ç‚¸åŠ¨ç”»
            gsap.to("#cake", {
                scale: 1.5,
                duration: 0.3,
                onComplete: function() {
                    document.getElementById('cake').textContent = "ğŸ’¥";
                    
                    // æ·»åŠ çˆ†ç‚¸æ•ˆæœ
                    const explosionEffect = document.createElement('div');
                    explosionEffect.style.position = 'absolute';
                    explosionEffect.style.top = '0';
                    explosionEffect.style.left = '0';
                    explosionEffect.style.width = '100%';
                    explosionEffect.style.height = '100%';
                    explosionEffect.style.background = 'radial-gradient(circle, rgba(255, 42, 109, 0.8) 0%, transparent 70%)';
                    explosionEffect.style.animation = 'fadeOut 1s forwards';
                    explosionEffect.style.zIndex = '10';
                    document.getElementById('cake').parentNode.appendChild(explosionEffect);
                    
                    // æ·»åŠ çˆ†ç‚¸åŠ¨ç”»æ ·å¼
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes fadeOut {
                            0% { opacity: 1; transform: scale(0); }
                            50% { opacity: 0.8; transform: scale(2); }
                            100% { opacity: 0; transform: scale(3); }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    // æ·¡å‡ºæ•´ä¸ªå¼€å±
                    gsap.to(".cyber-card", {
                        y: -50,
                        opacity: 0,
                        duration: 0.8,
                        ease: "power2.out"
                    });
                    
                    gsap.to(".decorative-elements", {
                        opacity: 0,
                        duration: 0.5
                    });
                    
                    gsap.to("#splash-screen", {
                        opacity: 0,
                        duration: 1.2,
                        delay: 0.3,
                        onComplete: function() {
                            document.getElementById('splash-screen').style.display = "none";
                            document.getElementById('main-content').style.display = "block";
                            initPage();
                        }
                    });
                }
            });
        });

        // å¹´é¾„è®¡æ•°å™¨åŠ¨ç”»
        function animateAgeCounter() {
            let counter = { value: 29.9999 };
            gsap.to(counter, {
                value: 30,
                duration: 3,
                onUpdate: function() {
                    document.getElementById('age-counter').textContent = counter.value.toFixed(4);
                },
                onComplete: function() {
                    document.getElementById('age-counter').textContent = "30.0000";
                    // æ·»åŠ é—ªçƒæ•ˆæœ
                    setInterval(function() {
                        document.getElementById('age-counter').style.textShadow = "0 0 10px " + (Math.random() > 0.5 ? "var(--neon-pink)" : "var(--neon-blue)");
                    }, 300);
                }
            });
        }

        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            const map = L.map('memory-map', {
                center: [35, 105], // é»˜è®¤ä»¥ä¸­å›½ä¸ºä¸­å¿ƒ
                zoom: 4,           // é»˜è®¤ç¼©æ”¾çº§åˆ«
                minZoom: 3,        // é™åˆ¶æœ€å°ç¼©æ”¾ï¼Œé˜²æ­¢ç¼©å¾—å¤ªå°å¯¼è‡´å†…å®¹æ¶ˆå¤±
                maxZoom: 18,       // é™åˆ¶æœ€å¤§ç¼©æ”¾
                crs: L.CRS.EPSG3857,
                worldCopyJump: true // å…è®¸åœ¨è·¨è¶Šå›½é™…æ—¥æœŸå˜æ›´çº¿æ—¶è‡ªåŠ¨è·³è½¬
            });
            
            // ä½¿ç”¨é«˜å¾·åœ°å›¾å›¾å±‚
            L.tileLayer('https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
                subdomains: ['1', '2', '3', '4'],
                attribution: '&copy; é«˜å¾·åœ°å›¾',
                className: 'cyber-map',
                minZoom: 3,
                maxZoom: 18
            }).addTo(map);
            
            // è‡ªå®šä¹‰åœ°å›¾æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .cyber-map {
                    filter: hue-rotate(180deg) contrast(1.2) saturate(1.5) brightness(0.7) invert(100%);
                }
                .leaflet-tile-container img {
                    box-sizing: content-box !important; /* æ¢å¤ç“¦ç‰‡çš„é»˜è®¤ç›’æ¨¡å‹ */
                }
            `;
            document.head.appendChild(style);
            
            // æ·»åŠ è®°å¿†ç‚¹ - ç°åœ¨ä½¿ç”¨æœ¬åœ°imagesæ–‡ä»¶å¤¹ä¸­çš„ç…§ç‰‡
            // ä½¿ç”¨window.memoriesä½¿å…¶æˆä¸ºå…¨å±€å˜é‡ï¼Œä»¥ä¾¿å…¶ä»–å‡½æ•°å¯ä»¥è®¿é—®
            window.memories = [
                {
                    latlng: [22.5431, 114.0579],
                    title: "æ·±åœ³",
                    content: "èµ·ç‚¹ï¼Œæ–°çš„èµ·ç‚¹ï¼",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_4.jpg", caption: "æ·±åœ³å¸‚ä¸­å¿ƒçš„ç¹åæ™¯è±¡" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_5.jpg", caption: "æ·±åœ³æ¹¾çš„ç¾ä¸½æ—¥è½" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_6.jpg", caption: "æ·±åœ³æ¹¾å…¬å›­" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_7.jpg", caption: "æ·±åœ³å¤œæ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_9.jpg", caption: "æ·±åœ³åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_10.jpg", caption: "æ·±åœ³åœ°æ ‡å»ºç­‘" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_11.jpg", caption: "æ·±åœ³ç°ä»£æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_3.jpg", caption: "æ·±åœ³å¤œæ™¯" }
                    ],
                    iconColor: "#ff2a6d"
                },
                {
                    latlng: [39.9042, 116.4074],
                    title: "åŒ—äº¬",
                    content: "ç«‹æ°´æ¡¥ä¼ å¥‡",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/beijing_1.jpg", caption: "æ•…å®«çš„å®ä¼Ÿå»ºç­‘" },
                        { url: "https://pic.tangsong.qzz.io/birthday/beijing_2.jpg", caption: "é•¿åŸä¸Šçš„å£®ä¸½é£æ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/beijing_3.jpg", caption: "åŒ—äº¬åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/beijing_4.jpg", caption: "åŒ—äº¬æ–‡åŒ–æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/beijing_5.jpg", caption: "åŒ—äº¬å†å²é—è¿¹" },
                        { url: "https://pic.tangsong.qzz.io/birthday/beijing_6.jpg", caption: "åŒ—äº¬ç°ä»£å»ºç­‘" }
                    ],
                    iconColor: "#05d9e8"
                },
                {
                    latlng: [31.2304, 121.4737],
                    title: "ä¸Šæµ·",
                    content: "è‹¦é€¼çš„å®ä¹ ä¹‹æ—…",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/shanghai_1.jpg", caption: "å¤–æ»©å¤œæ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shanghai_2.jpg", caption: "é™†å®¶å˜´é‡‘èåŒº" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shanghai_3.jpg", caption: "ä¸Šæµ·åŸå¸‚é£å…‰" }
                    ],
                    iconColor: "#d300c5"
                },
                {
                    latlng: [45.8038, 126.5340],
                    title: "å“ˆå°”æ»¨",
                    content: "å†°é›ªå•è¡£å‹‡é—¯å†°ä¹‹åŸï¼Œå†»æˆç‹—",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/haerbin_1.jpg", caption: "å†°é›ªå¤§ä¸–ç•Œ" },
                        { url: "https://pic.tangsong.qzz.io/birthday/haerbin_2.jpg", caption: "ä¸­å¤®å¤§è¡—" },
                        { url: "https://pic.tangsong.qzz.io/birthday/haerbin_3.jpg", caption: "å“ˆå°”æ»¨é£æ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/haerbin_4.jpg", caption: "å“ˆå°”æ»¨åŸå¸‚æ™¯è§‚" }
                    ],
                    iconColor: "#ff2a6d"
                },
                {
                    latlng: [29.3392, 104.7786],
                    title: "è‡ªè´¡",
                    content: "æˆ‘æ¥åˆ°ï¼Œä½ çš„åŸå¸‚",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/zigong_1.jpg", caption: "è‡ªè´¡æé¾™åšç‰©é¦†" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zigong_2.jpg", caption: "è‡ªè´¡å½©ç¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zigong_3.jpg", caption: "è‡ªè´¡é£æ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zigong_4.jpg", caption: "è‡ªè´¡åŸå¸‚æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zigong_5.jpg", caption: "è‡ªè´¡é—äº§" }
                    ],
                    iconColor: "#05d9e8"
                },
                {
                    latlng: [21.9162, 100.0719],
    latlng: [18.2528, 109.5120],
                    title: "ä¸‰äºš",
                    content: "é¸Ÿå·¢é…’åº—éå¸¸ä¸é”™'",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_1.jpg", caption: "ä¸‰äºšæ¹¾çš„æ¤°æ—æµ·æ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_2.jpg", caption: "äºšé¾™æ¹¾ç¾ä¸½çš„æ²™æ»©" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_3.jpg", caption: "ä¸‰äºšçƒ­å¸¦é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_4.jpg", caption: "ä¸‰äºšæ—¥è½ç¾æ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_5.jpg", caption: "ä¸‰äºšæµ·æ»©é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_6.jpg", caption: "ä¸‰äºšåº¦å‡é…’åº—" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_7.jpg", caption: "ä¸‰äºšçƒ­å¸¦æ¤ç‰©" },
                        { url: "https://pic.tangsong.qzz.io/birthday/sanya_8.jpg", caption: "ä¸‰äºšæ°´ä¸Šæ´»åŠ¨" }
                    ],
                    iconColor: "#ff2a6d"
                },
                {
                    latlng: [21.9162, 100.0719],
                    title: "è¥¿åŒç‰ˆçº³",
                    content: "æ³°å›½ç‹å¦ƒcosplay",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/xishuangbanna_3.jpg", caption: "è¥¿åŒç‰ˆçº³å¤œå¸‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/xishuangbanna_4.jpg", caption: "å‚£æ—èˆè¹ˆè¡¨æ¼”" },
                        { url: "https://pic.tangsong.qzz.io/birthday/xishuangbanna_5.jpg", caption: "çƒ­å¸¦æ¤ç‰©å›­" },
                        { url: "https://pic.tangsong.qzz.io/birthday/xishuangbanna_6.jpg", caption: "æ°‘æ—æ‘å¯¨" },
                        { url: "https://pic.tangsong.qzz.io/birthday/xishuangbanna_1.jpg", caption: "è¥¿åŒç‰ˆçº³æ—¥è½" },
                        { url: "https://pic.tangsong.qzz.io/birthday/xishuangbanna_2.jpg", caption: "å¤œé—´ç¯å…‰ç§€" }
                    ],
                    iconColor: "#05d9e8"
                },
                {
                    latlng: [35.2339, 115.4808],
                    title: "èæ³½",
                    content: "ä½ æ¥åˆ°ï¼Œæˆ‘çš„åŸå¸‚",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/heze_1.JPG", caption: "ç‰¡ä¸¹å›­ç››å¼€çš„ç‰¡ä¸¹" },
                        { url: "https://pic.tangsong.qzz.io/birthday/heze_2.jpg", caption: "æ›¹å·ç‰¡ä¸¹" },
                        { url: "https://pic.tangsong.qzz.io/birthday/heze_3.jpg", caption: "èæ³½ç‰¡ä¸¹æ–‡åŒ–" },
                        { url: "https://pic.tangsong.qzz.io/birthday/heze_4.jpg", caption: "èæ³½åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/heze_5.jpg", caption: "èæ³½å†å²é—è¿¹" },
                        { url: "https://pic.tangsong.qzz.io/birthday/heze_6.jpg", caption: "èæ³½è‡ªç„¶æ™¯è§‚" }
                    ],
                    iconColor: "#d300c5"
                },
                {
                    latlng: [55.7558, 37.6173],
                    title: "è«æ–¯ç§‘",
                    content: "æˆ‘çš„ç¬¬ä¸€æ¬¡å‡ºå›½",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/mosike_1.jpg", caption: "çº¢åœºå¤œæ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/mosike_2.jpg", caption: "åœ£ç“¦è¥¿é‡Œå¤§æ•™å ‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/mosike_3.jpg", caption: "è«æ–¯ç§‘åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/mosike_4.jpg", caption: "è«æ–¯ç§‘å†å²å»ºç­‘" },
                        { url: "https://pic.tangsong.qzz.io/birthday/mosike_5.jpg", caption: "è«æ–¯ç§‘æ–‡åŒ–æ™¯è§‚" }
                    ],
                    iconColor: "#ff2a6d"
                },
                {
                    latlng: [69.5985, 31.7827],
                    title: "æ‘©å°”æ›¼æ–¯å…‹",
                    content: "çœŸæ¼‚äº®å•Š",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/moermansike_1.jpg", caption: "åŒ—æå…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/moermansike_2.jpg", caption: "é˜¿å»–æ²™çºªå¿µç¢‘" },
                        { url: "https://pic.tangsong.qzz.io/birthday/moermansike_3.jpg", caption: "æ‘©å°”æ›¼æ–¯å…‹æ¸¯å£" },
                        { url: "https://pic.tangsong.qzz.io/birthday/moermansike_4.jpg", caption: "æ‘©å°”æ›¼æ–¯å…‹åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/moermansike_5.jpg", caption: "æ‘©å°”æ›¼æ–¯å…‹è‡ªç„¶æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/moermansike_6.jpg", caption: "æ‘©å°”æ›¼æ–¯å…‹æå…‰" }
                    ],
                    iconColor: "#05d9e8"
                },
                {
                    latlng: [7.8804, 98.3923],
                    title: "æ™®å‰å²›",
                    content: "æ³°å›½æœ€å¤§çš„å²›å±¿ï¼Œçƒ­å¸¦å¤©å ‚",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/pujidao_1.jpg", caption: "èŠ­ä¸œæµ·æ»©" },
                        { url: "https://pic.tangsong.qzz.io/birthday/pujidao_2.jpg", caption: "æ™®å‰å²›æ—¥è½" },
                        { url: "https://pic.tangsong.qzz.io/birthday/pujidao_3.jpg", caption: "æ™®å‰å²›æµ·æ»©" },
                        { url: "https://pic.tangsong.qzz.io/birthday/pujidao_4.jpg", caption: "æ™®å‰å²›çƒ­å¸¦é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/pujidao_5.jpg", caption: "æ™®å‰å²›è‡ªç„¶æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/pujidao_6.jpg", caption: "æ™®å‰å²›åº¦å‡é£æƒ…" }
                    ],
                    iconColor: "#d300c5"
                },
                {
                    latlng: [40.8424, 111.7496],
                    title: "å‘¼å’Œæµ©ç‰¹",
                    content: "è‹±å§¿é£’çˆ½",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/huhehaote_1.jpg", caption: "å‘¼å’Œæµ©ç‰¹è‰åŸé£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/huhehaote_2.jpg", caption: "å†…è’™å¤å¤§è‰åŸ" },
                        { url: "https://pic.tangsong.qzz.io/birthday/huhehaote_3.jpg", caption: "å‘¼å’Œæµ©ç‰¹åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/huhehaote_4.jpg", caption: "å†…è’™å¤æ–‡åŒ–æ™¯è§‚" }
                    ],
                    iconColor: "#05d9e8"
                },
                {
                    latlng: [35.6895, 139.6917],
                    title: "ä¸œäº¬",
                    content: "æˆ·éšç¥ç¤¾çœŸæ¼‚äº®",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_1.jpg", caption: "ä¸œäº¬å¡”å¤œæ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_2.jpg", caption: "æ¶©è°·åå­—è·¯å£" },
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_3.jpg", caption: "ä¸œäº¬åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_4.jpg", caption: "ä¸œäº¬ç°ä»£å»ºç­‘" },
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_5.jpg", caption: "ä¸œäº¬ä¼ ç»Ÿæ–‡åŒ–" },
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_6.jpg", caption: "ä¸œäº¬è¡—å¤´æ™¯è±¡" },
                        { url: "https://pic.tangsong.qzz.io/birthday/dongjing_7.jpg", caption: "ä¸œäº¬å¤œç”Ÿæ´»" }
                    ],
                    iconColor: "#ff2a6d"
                },
                {
                    latlng: [43.0618, 141.3545],
                    title: "æœ­å¹Œ",
                    content: "æ²¡æƒ³åˆ°æˆ‘ä»¬ä¹Ÿæ¥åˆ°äº†åŒ—æµ·é“",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/zhahuang_1.jpg", caption: "æœ­å¹Œé›ªç¥­" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zhahuang_2.jpg", caption: "æœ­å¹Œé’Ÿæ¥¼" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zhahuang_3.jpg", caption: "æœ­å¹ŒåŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zhahuang_4.jpg", caption: "æœ­å¹Œå†¬å­£æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/zhahuang_5.jpg", caption: "æœ­å¹Œæ–‡åŒ–æ™¯ç‚¹" }
                    ],
                    iconColor: "#05d9e8"
                },
                {
                    latlng: [22.5431, 114.0579],
                    title: "æ·±åœ³ å†æ¬¡å‡ºå‘",
                    content: "å›åˆ°èµ·ç‚¹ï¼Œå¼€å§‹æ–°çš„æ—…ç¨‹",
                    photos: [
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_4.jpg", caption: "æ·±åœ³å¸‚ä¸­å¿ƒçš„ç¹åæ™¯è±¡" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_5.jpg", caption: "æ·±åœ³æ¹¾çš„ç¾ä¸½æ—¥è½" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_6.jpg", caption: "æ·±åœ³æ¹¾å…¬å›­" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_7.jpg", caption: "æ·±åœ³å¤œæ™¯" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_9.jpg", caption: "æ·±åœ³åŸå¸‚é£å…‰" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_10.jpg", caption: "æ·±åœ³åœ°æ ‡å»ºç­‘" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_11.jpg", caption: "æ·±åœ³ç°ä»£æ™¯è§‚" },
                        { url: "https://pic.tangsong.qzz.io/birthday/shenzhen_3.jpg", caption: "æ·±åœ³å¤œæ™¯" }
                    ],
                    iconColor: "#d300c5"
                }
            ];
            
            // åˆ›å»ºè¿çº¿
            const latlngs = memories.map(m => m.latlng);
            const polyline = L.polyline(latlngs, {
                color: '#05d9e8',
                weight: 2,
                dashArray: '10, 10',
                lineJoin: 'round'
            }).addTo(map);
            
            // åŠ¨ç”»ç»˜åˆ¶è·¯å¾„
            polyline._path.classList.add('path-animation');
            
            // æ·»åŠ è®°å¿†ç‚¹æ ‡è®°
            memories.forEach(memory => {
                const marker = L.circleMarker(memory.latlng, {
                    radius: 8,
                    fillColor: memory.iconColor,
                    color: "#fff",
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);
                
                // åˆ›å»ºç…§ç‰‡ç¼©ç•¥å›¾HTML
                const thumbnailsHTML = memory.photos.map((photo, index) => `
                    <img src="${photo.url}" class="photo-thumbnail" 
                         onclick="showSpecificPhoto(${JSON.stringify(memory.photos)}, ${index})"
                         title="${photo.caption}">
                `).join('');
                
                marker.bindPopup(`
                    <div style="background: #0d0221; color: white; padding: 10px; border: 1px solid ${memory.iconColor}; max-width: 300px;">
                        <h3 style="margin: 0 0 5px 0; color: ${memory.iconColor};">${memory.title}</h3>
                        <p style="margin: 0 0 10px 0;">${memory.content}</p>
                        <div style="text-align: center;">
                            <button onclick="showLocationPhotos(${JSON.stringify(memory).replace(/"/g, '&quot;')})" 
                                    style="background: ${memory.iconColor}; border: none; padding: 5px 10px; cursor: pointer; color: #0d0221;">
                                æŸ¥çœ‹è®°å¿† (${memory.photos.length}å¼ )
                            </button>
                        </div>
                        <div class="thumbnail-container">
                            ${thumbnailsHTML}
                        </div>
                    </div>
                `);
                
                // æ·»åŠ è„‰å†²åŠ¨ç”»
                setInterval(() => {
                    marker.setStyle({
                        fillOpacity: 0.4 + Math.random() * 0.6
                    });
                }, 1000);
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('location-count').textContent = memories.length;
            document.getElementById('total-distance').textContent = "12,345";
            
            // è°ƒæ•´åœ°å›¾è§†å›¾ - é»˜è®¤æ˜¾ç¤ºä¸­å›½èŒƒå›´ï¼Œä¸å†å¼ºåˆ¶ç¼©æ”¾è‡³æ‰€æœ‰ç‚¹
            // map.fitBounds(polyline.getBounds(), { padding: [50, 50] });
        }
        
        // å½“å‰å±•ç¤ºçš„ä½ç½®ç…§ç‰‡æ•°æ®
        let currentLocationPhotos = [];
        let currentPhotoIndex = 0;

        // æ˜¾ç¤ºç‰¹å®šåœ°ç‚¹çš„ç…§ç‰‡é›†
        function showLocationPhotos(memory) {
            currentLocationPhotos = memory.photos;
            currentPhotoIndex = 0;
            updatePhotoModal();
            document.getElementById('photo-modal').style.display = 'block';
            
            // æ·»åŠ ç…§ç‰‡å¢™æ ‡é¢˜
            const modalTitle = document.querySelector('.modal-content h3');
            if (modalTitle) {
                modalTitle.textContent = `${memory.title} - è®°å¿†ç…§ç‰‡å¢™ (${memory.photos.length}å¼ )`;
            }
            
            // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
            document.addEventListener('keydown', handleKeyDown);
        }
        
        // é”®ç›˜äº‹ä»¶å¤„ç†å‡½æ•°
        function handleKeyDown(e) {
            if (document.getElementById('photo-modal').style.display === 'block') {
                if (e.key === 'ArrowLeft') {
                    plusSlides(-1);
                } else if (e.key === 'ArrowRight') {
                    plusSlides(1);
                }
            }
        }

        // æ˜¾ç¤ºç‰¹å®šç´¢å¼•çš„ç…§ç‰‡
        function showSpecificPhoto(photos, index) {
            currentLocationPhotos = photos;
            currentPhotoIndex = index;
            updatePhotoModal();
            document.getElementById('photo-modal').style.display = 'block';
            
            // æ»šåŠ¨åˆ°å½“å‰é€‰ä¸­çš„ç¼©ç•¥å›¾
            setTimeout(() => {
                const activeThumb = document.querySelector('.photo-thumbnail[style*="scale(1.1)"]');
                if (activeThumb) {
                    activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 100);
        }

        // æ›´æ–°ç…§ç‰‡æ¨¡æ€æ¡†å†…å®¹
        function updatePhotoModal() {
            if (currentLocationPhotos.length === 0) return;
            
            const modal = document.getElementById('photo-modal');
            const photo = currentLocationPhotos[currentPhotoIndex];
            
            // æ›´æ–°ä¸»ç…§ç‰‡
            const mainImg = modal.querySelector('img');
            mainImg.src = photo.url;
            // è®¾ç½®åˆå§‹çŠ¶æ€ä¸ºå°å›¾æ¨¡å¼
            mainImg.style.maxHeight = '60vh';
            mainImg.style.cursor = 'zoom-in';
            // æ·»åŠ æç¤ºæ–‡æœ¬
            const zoomHint = document.createElement('div');
            zoomHint.className = 'zoom-hint';
            zoomHint.textContent = 'ç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹åŸå›¾';
            zoomHint.style.position = 'absolute';
            zoomHint.style.bottom = '10px';
            zoomHint.style.right = '10px';
            zoomHint.style.background = 'rgba(0, 0, 0, 0.7)';
            zoomHint.style.color = 'var(--neon-blue)';
            zoomHint.style.padding = '5px 10px';
            zoomHint.style.borderRadius = '5px';
            zoomHint.style.fontSize = '0.8rem';
            zoomHint.style.opacity = '0.8';
            
            // æ¸…é™¤ä¹‹å‰çš„æç¤ºï¼ˆå¦‚æœæœ‰ï¼‰
            const oldHint = modal.querySelector('.zoom-hint');
            if (oldHint) oldHint.remove();
            
            // æ·»åŠ æ–°æç¤º
            modal.querySelector('.photo-slide').appendChild(zoomHint);
            
            mainImg.onclick = function() {
                // åˆ‡æ¢å¤§å›¾æŸ¥çœ‹æ¨¡å¼
                if(this.style.maxHeight === '90vh') {
                    this.style.maxHeight = '60vh';
                    this.style.cursor = 'zoom-in';
                    zoomHint.textContent = 'ç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹åŸå›¾';
                } else {
                    this.style.maxHeight = '90vh';
                    this.style.cursor = 'zoom-out';
                    zoomHint.textContent = 'ç‚¹å‡»å›¾ç‰‡å¯ç¼©å°';
                }
            };
            modal.querySelector('.photo-caption').textContent = 
                `${photo.caption} (${currentPhotoIndex + 1}/${currentLocationPhotos.length})`;
            
            // æ›´æ–°ç¼©ç•¥å›¾å®¹å™¨
            const thumbnailContainer = document.getElementById('thumbnail-container');
            thumbnailContainer.innerHTML = currentLocationPhotos.map((p, i) => `
                <img src="${p.url}" class="photo-thumbnail" 
                     onclick="showSpecificPhoto(currentLocationPhotos, ${i})"
                     style="${i === currentPhotoIndex ? 'border-color: var(--neon-pink); transform: scale(1.1);' : ''}"
                     title="${p.caption}"
                     style="--photo-index: ${i}; ${i === currentPhotoIndex ? 'border-color: var(--neon-pink); transform: scale(1.1);' : ''}">
            `).join('');
            
            // é‡ç½®åŠ¨ç”»
            setTimeout(() => {
                const thumbnails = thumbnailContainer.querySelectorAll('.photo-thumbnail');
                thumbnails.forEach((thumbnail, index) => {
                    thumbnail.addEventListener('click', function() {
                        const modal = document.getElementById('photo-modal');
                        const photoSlide = modal.querySelector('.photo-slide');
                        const img = photoSlide.querySelector('img');
                        const caption = photoSlide.querySelector('.photo-caption');
                
                        img.src = thumbnail.src;
                        caption.textContent = `ç…§ç‰‡ ${index + 1}`;
                
                        modal.style.display = 'block';
                        photoSlide.style.display = 'block';
                    });
                });
                
                const closeModal = (modalId) => {
                    const modal = document.getElementById(modalId);
                    modal.style.display = 'none';
                    const photoSlide = modal.querySelector('.photo-slide');
                    photoSlide.style.display = 'none';
                };
            }, 50);
        }

        // ç…§ç‰‡å¯¼èˆª
        function plusSlides(n) {
            currentPhotoIndex += n;
            if (currentPhotoIndex >= currentLocationPhotos.length) currentPhotoIndex = 0;
            if (currentPhotoIndex < 0) currentPhotoIndex = currentLocationPhotos.length - 1;
            updatePhotoModal();
            
            // æ»šåŠ¨åˆ°å½“å‰é€‰ä¸­çš„ç¼©ç•¥å›¾
            setTimeout(() => {
                const activeThumb = document.querySelector('.photo-thumbnail[style*="scale(1.1)"]');
                if (activeThumb) {
                    activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            }, 100);
        }
        
        // æ§åˆ¶å°äº¤äº’
        function setupConsole() {
            const consoleInput = document.getElementById('console-input');
            const consoleOutput = document.getElementById('console-output');
            
            consoleInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const command = consoleInput.value.trim();
                    consoleInput.value = '';
                    
                    // æ·»åŠ è¾“å…¥åˆ°æ§åˆ¶å°
                    const inputLine = document.createElement('div');
                    inputLine.className = 'console-line';
                    inputLine.innerHTML = `<span class="prompt">></span> ${command}`;
                    consoleOutput.appendChild(inputLine);
                    
                    // å¤„ç†å‘½ä»¤
                    processCommand(command);
                    
                    // æ»šåŠ¨åˆ°åº•éƒ¨
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                }
            });
        }
        
        function processCommand(command) {
            const consoleOutput = document.getElementById('console-output');
            const response = document.createElement('div');
            response.className = 'console-line';
            
            switch(command.toLowerCase()) {
                case 'help':
                    response.innerHTML = `
                        å¯ç”¨å‘½ä»¤:<br>
                        - HELP: æ˜¾ç¤ºæ­¤å¸®åŠ©<br>
                        - MEMORIES: æ˜¾ç¤ºè®°å¿†ç‚¹æ•°é‡<br>
                        - LOVE: ç‰¹æ®Šå‘½ä»¤<br>
                        - GLITCH: æ¿€æ´»æ•…éšœæ•ˆæœ<br>
                        - CLEAR: æ¸…ç©ºæ§åˆ¶å°<br>
                        - ä½ çš„åå­—: è§¦å‘å½©è›‹
                    `;
                    break;
                case 'memories':
                    response.textContent = `ç³»ç»Ÿè®°å½•çš„è®°å¿†ç‚¹æ•°é‡: ${document.getElementById('location-count').textContent}`;
                    break;
                case 'love':
                    response.innerHTML = `<span style="color: var(--neon-pink);">ç³»ç»Ÿæ£€æµ‹åˆ°æ— æ³•é‡åŒ–çš„æƒ…æ„Ÿæ•°æ®...</span>`;
                    break;
                case 'glitch':
                    activateGlitch();
                    response.textContent = "æ¿€æ´»æ•…éšœæ•ˆæœ...";
                    break;
                case 'clear':
                    consoleOutput.innerHTML = '';
                    return; // ä¸æ·»åŠ å“åº”è¡Œ
                case 'æ·»å‡€':
                    const loveMessages = [
                        "ä»Šå¤©æ˜¯ä½ 30å²ç”Ÿæ—¥,ä¹Ÿæ˜¯å’Œä½ ç›¸è¯†çš„ç¬¬å…«å¹´ï¼Œç»“å©šçš„ç¬¬ä¸‰å¹´ï¼Œæ—¶é—´åƒæˆ‘ä»¬è‡ªé©¾æ¸¸æ—¶ç›˜å±±å…¬è·¯çš„è½¬è§’ï¼Œæ˜æ˜è®°å¾—æ¯ä¸ªè½¬å¼¯æ—¶çš„å¿ƒè·³ï¼Œå›å¤´æœ›å»å´å·²æ˜¯ä¸€è·¯ç¹èŠ±ã€‚",
                        "è¿˜è®°å¾—æ·é‡Œåˆ«å°”å¡é£˜é›ªçš„å¤œæ™šï¼Œä½ å¸¦ç€åšåšçš„æ‰‹å¥—é€—å¼„è·Ÿè¿‡æ¥çš„é›ªæ©‡çŠ¬ï¼Œä»¥é˜²æš´é›ªå°è·¯æˆ‘ä»¬ä¸‹å®šå†³å¿ƒè¿å¤œæ‰¾è½¦é€ƒç¦»ï¼›æ‘©å°”æ›¼æ–¯å…‹å‡›å†½çš„å¯’é£ä¸‹ï¼Œæˆ‘ä»¬ç«™åœ¨é˜¿å»–æ²™å…¬å›­çš„æœ€é«˜ç‚¹ï¼Œçœºæœ›è¿œå¤„çš„ç å¤´å’Œæ‘åº„ã€‚è¿™äº›æ—…ç¨‹åƒå›´å·¾ä¸€èˆ¬ï¼Œé’ˆè„šç»†å¯†å´æ¸©æš–è¸å®ã€‚åæ¥æˆ‘ä»¬å»è¿‡çš„åœ°æ–¹ï¼Œåœ°å›¾ä¸Šéƒ½å˜æˆäº†ä¸“å±çš„åæ ‡â€”â€”æ›¼è°·çš„å¤§çš‡å®«ï¼Œæ™®å‰å²›çš„æµªèŠ±ï¼Œé•¿é‡çš„æˆ·éšç¥ç¤¾ï¼Œå‡½é¦†å±±çš„å¤§é›ªï¼ŒåŒ—æµ·é“çš„æ¸©æ³‰é›¾æ°”ã€‚",
                        "å·¥ä½œåçš„æ„Ÿæƒ…å°‘äº†äº›è½°è½°çƒˆçƒˆï¼Œå€’åƒä¸€ç¢—æ¡‚èŠ±é†ªç³Ÿï¼Œç”œå‘³æ²‰æ·€åœ¨ç”Ÿæ´»è¤¶çš±é‡Œã€‚ä¸‹ç­å’Œä½ ä¸€å—å›å®¶ï¼Œåœ¨å®¢å…é‡Œçœ‹ä½ åšé¥­ï¼Œé€—ä¸€ä¼šçŒ«çŒ«ï¼Œæ—¶ä¸æ—¶å»å¨æˆ¿æ‰“æ‰“ä¸‹æ‰‹ï¼Œä¸€å—è¾¹çœ‹ç»¼è‰ºèŠ‚ç›®è¾¹åƒé¥­ã€‚\næˆ‘å¶å°”ä¼šæƒ³,å¦‚æœæˆ‘ç°åœ¨è¿˜æ˜¯ä¸€ä¸ªäººï¼Œä¼šè¿‡ç€æ€æ ·çš„ç”Ÿæ´»å‘¢ï¼Œè‚¯å®šæ˜¯å•è°ƒæ— è¶£çš„ï¼Œå¦‚åŒä½ ä¸åœ¨çš„å‘¨æœ«ã€‚",
                        "30å²æ˜¯æ–°çš„èµ·ç‚¹,ä½†å¯¹æˆ‘è€Œè¨€ï¼Œä½ ä¾ç„¶æ˜¯é‚£ä¸ªåœ¨é¦–æ¬¡è‡ªé©¾åœ¨å—æ¾³å¤§æ¡¥ä¸Šæ¬¢å‘¼é›€è·ƒçš„å§‘å¨˜ã€‚è°¢è°¢ä½ è®©æˆ‘ä»'å®…ç”·'å˜æˆ'æ—…äºº'ï¼Œä»'æœ¨å¤´'å˜æˆä¼šç¬¨æ‹™è¡¨è¾¾çˆ±çš„ä¸ˆå¤«ã€‚å¾€åä½™ç”Ÿï¼Œæƒ³å’Œä½ ç»§ç»­æ”¶é›†æ›´å¤šå¹³å‡¡çš„ç¬é—´ï¼šå¯èƒ½æ˜¯æ‰“åŒäººæ¸¸æˆæ—¶çš„äº’ç›¸å˜²è®½ï¼Œå¯èƒ½æ˜¯åœ¨ä½ ç”»ç”»æ—¶é€’è¿‡å»çš„ä¸€æ¯çƒ­æ°´ï¼Œå¯èƒ½æ˜¯æˆ‘åœ¨å·¥ä½œæ—¶ä½ çªç„¶å†²è¿‡æ¥çš„ä¸€ä¸ªæ‹¥æŠ±ã€‚",
                        "æˆ‘ä¾ç„¶æ²¡è®°ä½ä½ åœ¨ç»“å©šå…¸ç¤¼ä¸Šçš„é‚£å¥ä»€ä¹ˆæ ‘ä»€ä¹ˆé£æ˜¯æ€ä¹ˆè¯´çš„ï¼Œåªå¥½ç”¨ç®€å•çš„è¯è¯­é€ä¸Šæˆ‘çš„ç¥ç¦ã€‚",
                        "ç”Ÿæ—¥å¿«ä¹ï¼Œæˆ‘çš„å§‘å¨˜ã€‚",
                        "æ°¸è¿œï¼Œçˆ±ä½ å¦‚åˆï¼"
                    ];
                    document.getElementById('envelope-modal').style.display = 'block';
                    break;
                    
                    // æ˜¾ç¤ºæ‰€æœ‰è¡Œï¼Œé€å­—æ˜¾ç¤º
                    for (let i = 0; i < loveMessages.length; i++) {
                        setTimeout(() => {
                            const loveLine = document.createElement('div');
                            loveLine.className = 'console-line';
                            consoleOutput.appendChild(loveLine);
                            
                            let charIndex = 0;
                            const message = loveMessages[i];
                            const interval = setInterval(() => {
                                if (charIndex < message.length) {
                                    loveLine.innerHTML = message.substring(0, charIndex + 1);
                                    charIndex++;
                                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                                } else {
                                    clearInterval(interval);
                                }
                            }, 100);
                        }, 2000 + (i - 4) * 1000);
                    }
                    break;
                default:
                    response.textContent = `æœªçŸ¥å‘½ä»¤: ${command}`;
            }
            
            consoleOutput.appendChild(response);
        }
        
        // æ•…éšœæ•ˆæœ
        function activateGlitch() {
            document.body.classList.add('glitch-effect');
            
            // æ’­æ”¾alarméŸ³æ•ˆ
            var alarmSound = new Audio('sounds/alarm.mp3');
            alarmSound.play();
            
            setTimeout(() => {
                document.body.classList.remove('glitch-effect');
                // åœæ­¢éŸ³æ•ˆ
                alarmSound.pause();
            }, 1800);
            
            // æ·»åŠ æ•…éšœæ ·å¼
            const style = document.createElement('style');
            style.id = 'glitch-style';
            style.textContent = `
                @keyframes glitch {
                    0% { filter: hue-rotate(0deg); }
                    20% { filter: hue-rotate(90deg); }
                    40% { filter: hue-rotate(180deg) blur(1px); }
                    60% { filter: hue-rotate(270deg); }
                    80% { filter: hue-rotate(360deg) blur(2px); }
                    100% { filter: hue-rotate(0deg); }
                }
                .glitch-effect {
                    animation: glitch 0.5s linear;
                }
                
                @keyframes textGlitch {
                    0% { transform: translate(0); text-shadow: 0 0 5px var(--neon-pink); }
                    10% { transform: translate(-2px, 2px); text-shadow: 0 0 10px var(--neon-blue); }
                    20% { transform: translate(2px, -2px); text-shadow: 0 0 15px var(--neon-purple); }
                    30% { transform: translate(-2px, -2px); text-shadow: 0 0 10px var(--neon-pink); }
                    40% { transform: translate(2px, 2px); text-shadow: 0 0 5px var(--neon-blue); }
                    50% { transform: translate(-1px, 1px); text-shadow: 0 0 15px var(--neon-purple); }
                    60% { transform: translate(1px, -1px); text-shadow: 0 0 10px var(--neon-pink); }
                    70% { transform: translate(-1px, -1px); text-shadow: 0 0 5px var(--neon-blue); }
                    80% { transform: translate(1px, 1px); text-shadow: 0 0 10px var(--neon-purple); }
                    90% { transform: translate(0); text-shadow: 0 0 15px var(--neon-pink); }
                    100% { transform: translate(0); text-shadow: 0 0 5px var(--neon-blue); }
                }
                
                @keyframes warningFlash {
                    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
                        opacity: 1;
                        color: var(--neon-pink);
                        text-shadow: 0 0 10px var(--neon-pink), 0 0 20px var(--neon-pink);
                    }
                    20%, 24%, 55% {
                        opacity: 0.8;
                        color: var(--neon-blue);
                        text-shadow: 0 0 5px var(--neon-blue);
                    }
                }
                
                @keyframes scanLine {
                    0% {
                        transform: translateY(-100%);
                    }
                    100% {
                        transform: translateY(100%);
                    }
                }
                
                .warning-container {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 9999;
                    background-color: rgba(13, 2, 33, 0.7);
                    pointer-events: none;
                    overflow: hidden;
                }
                
                .warning-text {
                    font-size: 6rem;
                    font-weight: bold;
                    text-transform: uppercase;
                    animation: textGlitch 0.3s infinite, warningFlash 1.5s infinite alternate;
                    letter-spacing: 2px;
                    margin: 10px 0;
                }
                
                .scan-line {
                    position: absolute;
                    width: 100%;
                    height: 5px;
                    background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
                    animation: scanLine 2s linear infinite;
                }
                
                .glitch-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: repeating-linear-gradient(
                        0deg,
                        rgba(0, 0, 0, 0.1),
                        rgba(0, 0, 0, 0.1) 1px,
                        transparent 1px,
                        transparent 2px
                    );
                    pointer-events: none;
                    z-index: 1;
                }
            `;
            document.head.appendChild(style);
            
            // åˆ›å»ºè­¦å‘Šå®¹å™¨
            const warningContainer = document.createElement('div');
            warningContainer.className = 'warning-container';
            
            // æ·»åŠ æ‰«æçº¿
            const scanLine1 = document.createElement('div');
            scanLine1.className = 'scan-line';
            warningContainer.appendChild(scanLine1);
            
            // æ·»åŠ æ•…éšœçº¿æ¡è¦†ç›–å±‚
            const glitchOverlay = document.createElement('div');
            glitchOverlay.className = 'glitch-overlay';
            warningContainer.appendChild(glitchOverlay);
            
            // æ·»åŠ è­¦å‘Šæ–‡æœ¬
            const warningText1 = document.createElement('div');
            warningText1.className = 'warning-text';
            warningText1.textContent = 'å±é™©ï¼';
            warningContainer.appendChild(warningText1);
            
            const warningText2 = document.createElement('div');
            warningText2.className = 'warning-text';
            warningText2.textContent = 'çˆ±æ„æº¢å‡ºï¼';
            warningContainer.appendChild(warningText2);
            
            const warningText3 = document.createElement('div');
            warningText3.className = 'warning-text';
            warningText3.textContent = 'ç³»ç»Ÿæ•…éšœï¼';
            warningContainer.appendChild(warningText3);
            
            // æ·»åŠ ç¬¬äºŒæ¡æ‰«æçº¿
            const scanLine2 = document.createElement('div');
            scanLine2.className = 'scan-line';
            scanLine2.style.animationDelay = '1s';
            warningContainer.appendChild(scanLine2);
            
            // å°†è­¦å‘Šå®¹å™¨æ·»åŠ åˆ°body
            document.body.appendChild(warningContainer);
            
            // 3ç§’åç§»é™¤è­¦å‘Š
            setTimeout(() => {
                document.body.removeChild(warningContainer);
            }, 3000);
            
            // æ·»åŠ æ§åˆ¶å°æ¶ˆæ¯
            const consoleOutput = document.getElementById('console-output');
            const line = document.createElement('div');
            line.className = 'console-line';
            line.innerHTML = `<span style="color: var(--neon-purple);">è­¦å‘Š: ç³»ç»Ÿå‡ºç°æ•…éšœæ•ˆæœ! æ£€æµ‹åˆ°çˆ±æ„æº¢å‡º!</span>`;
            consoleOutput.appendChild(line);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            animateAgeCounter();
            initMap();
            setupConsole();
            
            // æ·»åŠ æ§åˆ¶å°æ¬¢è¿æ¶ˆæ¯
            setTimeout(() => {
                const consoleOutput = document.getElementById('console-output');
                const line = document.createElement('div');
                line.className = 'console-line';
                line.innerHTML = `<span style="color: var(--neon-pink);">> ç³»ç»Ÿå‡†å¤‡å°±ç»ª! è¾“å…¥ HELP è·å–å‘½ä»¤åˆ—è¡¨</span>`;
                consoleOutput.appendChild(line);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }, 2000);
            
            // æ§åˆ¶å°éšæœºæ¶ˆæ¯
            const messages = [
                "> æ£€æµ‹åˆ°é«˜æµ“åº¦å¹¸ç¦æŒ‡æ•°...",
                "> è­¦å‘Š: ç¬‘å®¹æ•°æ®è¶…å‡ºæ­£å¸¸èŒƒå›´!",
                "> è¾“å…¥'ä½ çš„åå­—'æœ‰æƒŠå–œ!",
                "> æ­£åœ¨è®¡ç®—ä¸‹æ¬¡å†’é™©è·¯çº¿...",
                "> è®°å¿†å­˜å‚¨ç©ºé—´å‰©ä½™: âˆ",
                "> è¾“å…¥'ä½ çš„åå­—'æœ‰æƒŠå–œ!",
                "> ç”Ÿæ—¥ç¥ç¦æ¨¡å—å·²æ¿€æ´»: 30å²å¿«ä¹!",
                "> ç³»ç»Ÿæ£€æµ‹åˆ°å¤§é‡ç¾å¥½å›å¿†æ•°æ®...",
                "> è¾“å…¥'ä½ çš„åå­—'æœ‰æƒŠå–œ!",
                "> è­¦å‘Š: å¯çˆ±åº¦çªç ´å¤©é™…!",
                "> æ­£åœ¨åŠ è½½ç‰¹åˆ«ç”Ÿæ—¥æƒŠå–œ...",
                "> å»ºè®®: ä»Šå¤©å¯ä»¥ä»»æ€§ä¸€æ•´å¤©!"
            ];
            
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const consoleOutput = document.getElementById('console-output');
                    const line = document.createElement('div');
                    line.className = 'console-line';
                    line.textContent = messages[Math.floor(Math.random() * messages.length)];
                    consoleOutput.appendChild(line);
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                }
            }, 5000);
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†å‡½æ•°
        function showModal(modalType) {
            if(modalType === 'photos') {
                // è·å–åœ°å›¾ä¸­å®šä¹‰çš„memorieså˜é‡
                const mapMemories = window.memories || [];
                
                // åˆå§‹åŒ–ç…§ç‰‡æ•°æ® - ä½¿ç”¨memoriesæ•°ç»„ä¸­çš„æ‰€æœ‰ç…§ç‰‡
                currentLocationPhotos = [];
                
                // ä»æ‰€æœ‰è®°å¿†ç‚¹æ”¶é›†ç…§ç‰‡
                mapMemories.forEach(memory => {
                    memory.photos.forEach(photo => {
                        // æ·»åŠ ä½ç½®ä¿¡æ¯åˆ°ç…§ç‰‡æ ‡é¢˜
                        currentLocationPhotos.push({
                            url: photo.url,
                            caption: `${memory.title} - ${photo.caption}`
                        });
                    });
                });
                
                if (currentLocationPhotos.length > 0) {
                    currentPhotoIndex = 0;
                    updatePhotoModal();
                    document.getElementById('photo-modal').style.display = 'block';
                    
                    // æ·»åŠ ç…§ç‰‡å¢™æ ‡é¢˜
                    const modalTitle = document.querySelector('.modal-content h3');
                    if (modalTitle) {
                        modalTitle.textContent = `è®°å¿†ç…§ç‰‡å¢™ (${currentLocationPhotos.length}å¼ )`;
                    }
                } else {
                    console.error('æ— æ³•è·å–ç…§ç‰‡æ•°æ®ï¼Œè¯·ç¡®ä¿é¡µé¢å·²å®Œå…¨åŠ è½½');
                    // æ·»åŠ ä¸€ä¸ªæç¤ºä¿¡æ¯åˆ°æ§åˆ¶å°
                    const consoleOutput = document.getElementById('console-output');
                    if (consoleOutput) {
                        const line = document.createElement('div');
                        line.className = 'console-line';
                        line.innerHTML = `<span style="color: var(--neon-pink);">ç³»ç»Ÿé”™è¯¯: è®°å¿†æ•°æ®å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨åå†è¯•!</span>`;
                        consoleOutput.appendChild(line);
                        consoleOutput.scrollTop = consoleOutput.scrollHeight;
                    }
                }
            }
        }
        
        // å…³é—­æ¨¡æ€æ¡†å‡½æ•°
        function closeModal(modalType) {
            // ç§»é™¤é”®ç›˜äº‹ä»¶ç›‘å¬
            document.removeEventListener('keydown', handleKeyDown);
            if(modalType === 'photos') {
                document.getElementById('photo-modal').style.display = "none";
            }
        }
        
        // ç‚¹å‡»é¡µé¢ä»»ä½•åœ°æ–¹å…³é—­æ¨¡æ€æ¡†
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = "none";
            }
        }
    </script>
</body>
</html>
<div id="speaker-icon" style="position: absolute; top: 10px; right: 10px; cursor: pointer;">ğŸ”Š</div>